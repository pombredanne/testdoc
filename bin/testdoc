#!/usr/bin/python

import inspect
import os
import sys
import testdoc
from testdoc import documenter, finder, formatter, reflect


def usage():
    return "Usage: testdoc <fully-qualified module name>"


def string_to_module(argument):
    if os.path.exists(argument):
        return reflect.filenameToModule(argument)
    obj = reflect.namedAny(argument)
    if not inspect.ismodule(obj):
        raise ValueError('%r is not a Python module' % (argument,))


def main():
    if len(sys.argv) != 2:
        print usage()
        sys.exit(2)
    try:
        module = string_to_module(sys.argv[1])
    except:
        print usage()
        raise
    format = formatter.WikiFormatter(sys.stdout)
    doc = documenter.Documenter(format)
    finder.find_tests(doc, module)


if __name__ == '__main__':
    main()
